@model WebApp.Models.CartViewModel
@{
    ViewData["Title"] = "Mi Carrito";
}

<h2>Mi Carrito</h2>

@if (!Model.Items.Any())
{
    <p>Tu carrito está vacío.</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        @foreach(var it in Model.Items)
        {
            <tr>
                <td>
                    <img src="@(it.ImagenUrl ?? "/images/placeholder.png")" style="height:50px;width:50px;object-fit:cover" class="me-2" />
                    @it.Nombre
                </td>
                <td>Bs. @it.Precio.ToString("F2")</td>
                <td>
                    <div class="d-flex align-items-center">
                        <form asp-action="UpdateQuantity" method="post" class="me-2 d-inline-block">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productoId" value="@it.ProductoId" />
                            <input type="number" name="cantidad" value="@it.Cantidad" min="1" max="999" class="form-control form-control-sm" style="width:80px;display:inline;" />
                            <button type="submit" class="btn btn-sm btn-primary ms-1">✎</button>
                        </form>
                        <form asp-action="UpdateQuantity" method="post" class="d-inline-block">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productoId" value="@it.ProductoId" />
                            <input type="hidden" name="cantidad" value="@(it.Cantidad - 1)" />
                            <button type="submit" class="btn btn-sm btn-secondary">-</button>
                        </form>
                        <form asp-action="UpdateQuantity" method="post" class="ms-1 d-inline-block">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productoId" value="@it.ProductoId" />
                            <input type="hidden" name="cantidad" value="@(it.Cantidad + 1)" />
                            <button type="submit" class="btn btn-sm btn-secondary">+</button>
                        </form>
                    </div>
                </td>
                <td>Bs. @((it.Precio * it.Cantidad).ToString("F2"))</td>
                <td>
                    <form asp-action="RemoveFromCart" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="productoId" value="@it.ProductoId" />
                        <button class="btn btn-sm btn-danger" type="submit">Remover</button>
                    </form>
                </td>
            </tr>
        }
        </tbody>
    </table>
    <h4>Total: Bs. @Model.Total.ToString("F2")</h4>

    <form asp-action="Clear" method="post" class="mt-3">
        @Html.AntiForgeryToken()
        <button class="btn btn-secondary">Vaciar carrito</button>
    </form>
}
